<h2>Afanasy SQL Database</h2>

<p>Afanasy uses <b><a href="http://www.postgresql.org" target="_blank">PostgreSQL</a></b> engine</p>

<p>
You don't need to install it on clients.
SQL database server is needed for Afanasy server only.
It is better to install it on the same host as Afanasy server.
</p>
<p>
Database server needed to store jobs, renders, users state.
Afanasy reads information from database on start.
You can use Afanasy without any database, but server will start with no data.
So you can skip this stage if you want just to try Afanasy.
</p>

<h3>Database Setup</h3>
<ul>
   <li>
      Edit Postgre SQL client authentication configuration file <kbd>pg_hba.conf</kbd>.<br/>
      Its location depends on Linux distributive. For example:<br/>
      Debian, Ubuntu: <kbd>/etc/postgresql/ [version] /main/pg_hba.conf</kbd><br/>
      CentOS, Fedora, openSUSE: <kbd>/var/lib/pgsql/data/pg_hba.conf</kbd><br/>
      <i>make install</i>:<kbd>/usr/local/pgsql/data/pg_hba.conf</kbd><br/>
      Add this line<br/>
      <kbd>local afanasy afadmin password</kbd><br/>
      Read comments in this file to know what does it mean.<br/>
      (If problems with authentication try <kbd>trust</kbd> for all methods.)
   </li>
   <li>
      Restart database<br/>
   </li>
   <li>
      Create afanasy database and user<br/>
      <code>
      # su - postgres<br/>
      $ createdb afanasy<br/>
      $ psql afanasy<br/>
      CREATE USER afadmin PASSWORD 'AfPassword';<br/>
      </code>
   </li>
</ul>

<h3>Create Tables</h3>
<ul>
   <li>
      Go into CGRU commands directory:<br />
      <code>$ cd cgru/afanasy/bin</code><br />
   </li>
   <li>
      Check database connection:<br />
      <code>$ ./afcmd db_check</code><br />
      Program will output error or print "Database connection is working" if everything is ok.<br />
   </li>
   <li>
      Create required tables:<br />
      <code>$ ./afcmd db_resetall</code><br />
      This command also delete old tables if they exists.<br />
   </li>
</ul>
<p>

<h2>Statistics</h2>

<h3>Web Interface to Afanasy SQL database</h3>
<p>You can watch all users jobs, users activity and various statistics tables and diagrams.</p>
<p>All you need is any web browser and connection with afanasy server.
No database connection or browser plugins need, all calculations are on server side,
you browser will receive plain html text and png images.</p>

<h3>Web Visor Setup</h3>
You need to install a web server with PHP, PGSQL and GD (to draw chart images) plugins.
Any UNIX have this packages.
<br/>
In most Linux-es all this can be provided by packages:
<br/>
<code>
apache2 libapache2-mod-php5 php5 php5-pgsql php5-gd
</code>
<br/>
Site is located in <kbd>cgru/afanasy/webvisor</kbd> folder.

<h3>Screenshots</h3>

<table>
   <caption><b>Users Table</b></caption>
   <tr>
      <td align="center" width="20%">
         <img src="images/afanasy/visor/statistics_users.jpg" alt="statistics_users" />
      </td>
   </tr>
</table>
<br/>
<table>
   <caption><b>Services Table</b></caption>
   <tr>
      <td align="center" width="20%">
         <img src="images/afanasy/visor/statistics_services.jpg" alt="statistics_services" />
      </td>
   </tr>
</table>

<h3>Table columns can be represent as a chart.</h3>

<table align="center">
   <caption><b>User Name / Jobs Number</b></caption>
   <tr>
      <td align="center" width="20%">
         <img src="images/afanasy/visor/chart_user_jobs.png" alt="chart_user_jobs" />
      </td>
   </tr>
</table>

<table align="center">
   <caption><b>User Name / Jobs Running Time Sum</b></caption>
   <tr>
      <td align="center" width="20%">
         <img src="images/afanasy/visor/chart_user_runtime.png" alt="chart_user_runtime" />
      </td>
   </tr>
</table>

<table align="center">
   <caption><b>Service Type/ Tasks Quantity</b></caption>
   <tr>
      <td align="center" width="20%">
         <img src="images/afanasy/visor/chart_service_tasks.png" alt="chart_service_tasks" />
      </td>
   </tr>
</table>

<table align="center">
   <caption><b>Service Type / Tasks Running Time Sum</b></caption>
   <tr>
      <td align="center" width="20%">
         <img src="images/afanasy/visor/chart_service_runtime.png" alt="chart_service_runtime" />
      </td>
   </tr>
</table>

